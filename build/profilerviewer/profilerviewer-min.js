(function(){YAHOO.widget.ProfilerViewer=function(h,g){g=g||{};if(arguments.length==1&&!YAHOO.lang.isString(h)&&!h.nodeName){g=h;h=g.element||null;}if(!h&&!g.element){h=this._createProfilerViewerElement();}YAHOO.widget.ProfilerViewer.superclass.constructor.call(this,h,g);this._init();};YAHOO.extend(YAHOO.widget.ProfilerViewer,YAHOO.util.Element);YAHOO.lang.augmentObject(YAHOO.widget.ProfilerViewer,{CLASS:"yui-pv",CLASS_DASHBOARD:"yui-pv-dashboard",CLASS_REFRESH:"yui-pv-refresh",CLASS_BUSY:"yui-pv-busy",CLASS_CHART_CONTAINER:"yui-pv-chartcontainer",CLASS_CHART:"yui-pv-chart",CLASS_CHART_LEGEND:"yui-pv-chartlegend",CLASS_TABLE:"yui-pv-table",STRINGS:{title:"YUI ProfilerViewer",buttons:{viewprofiler:"View Profiler Data",hideprofiler:"Hide Profiler Report",showchart:"Show Chart",hidechart:"Hide Chart",refreshdata:"Refresh Data"},colHeads:{fn:["Function/Method",null],calls:["Calls",40],avg:["Average",80],min:["Shortest",70],max:["Longest",70],total:["Total Time",70],pct:["Percent",70]},millisecondsAbbrev:"ms",initMessage:"initialiazing chart...",installFlashMessage:"Unable to load Flash content. The YUI Charts Control requires Flash Player 9.0.45 or higher. You can download the latest version of Flash Player from the <a href='http://www.adobe.com/go/getflashplayer'>Adobe Flash Player Download Center</a>."},timeAxisLabelFunction:function(h){var g=(h===Math.floor(h))?h:(Math.round(h*1000))/1000;return(g+" "+YAHOO.widget.ProfilerViewer.STRINGS.millisecondsAbbrev);},percentAxisLabelFunction:function(h){var g=(h===Math.floor(h))?h:(Math.round(h*100))/100;return(g+"%");}},true);var c=YAHOO.util.Dom;var a=YAHOO.util.Event;var b=YAHOO.tool.Profiler;var e=YAHOO.widget.ProfilerViewer;var d=e.prototype;d.refreshData=function(){this.fireEvent("dataRefreshEvent");};d.getHeadEl=function(){return(this._headEl)?c.get(this._headEl):false;};d.getBodyEl=function(){return(this._bodyEl)?c.get(this._bodyEl):false;};d.getChartEl=function(){return(this._chartEl)?c.get(this._chartEl):false;};d.getTableEl=function(){return(this._tableEl)?c.get(this._tableEl):false;};d.getDataTable=function(){return this._dataTable;};d.getChart=function(){return this._chart;};d._rendered=false;d._headEl=null;d._bodyEl=null;d._toggleVisibleEl=null;d._busyEl=null;d._busy=false;d._tableEl=null;d._dataTable=null;d._chartEl=null;d._chartLegendEl=null;d._chartElHeight=250;d._chart=null;d._chartInitialized=false;d._init=function(){this.createEvent("dataRefreshEvent");this.createEvent("renderEvent");this.on("dataRefreshEvent",this._refreshDataTable,this,true);this._initLauncherDOM();if(this.get("showChart")){this.on("sortedByChange",this._refreshChart);}};d._createProfilerViewerElement=function(){var g=document.createElement("div");document.body.insertBefore(g,document.body.firstChild);c.addClass(g,this.SKIN_CLASS);c.addClass(g,e.CLASS);return g;};d.toString=function(){return"ProfilerViewer "+(this.get("id")||this.get("tagName"));};d._toggleVisible=function(){var g=(this.get("visible"))?false:true;this.set("visible",g);};d._show=function(){if(!this._busy){this._setBusyState(true);if(!this._rendered){var g=new YAHOO.util.YUILoader();if(this.get("base")){g.base=this.get("base");}var h=["datatable"];if(this.get("showChart")){h.push("charts");}g.insert({require:h,onSuccess:function(){this._render();},scope:this});}else{var i=this.get("element");c.removeClass(i,"yui-pv-minimized");this._toggleVisibleEl.innerHTML=e.STRINGS.buttons.hideprofiler;c.addClass(i,"yui-pv-null");c.removeClass(i,"yui-pv-null");this.refreshData();}}};d._hide=function(){this._toggleVisibleEl.innerHTML=e.STRINGS.buttons.viewprofiler;c.addClass(this.get("element"),"yui-pv-minimized");};d._render=function(){c.removeClass(this.get("element"),"yui-pv-minimized");this._initViewerDOM();this._initDataTable();if(this.get("showChart")){this._initChartDOM();this._initChart();}this._rendered=true;this._toggleVisibleEl.innerHTML=e.STRINGS.buttons.hideprofiler;this.fireEvent("renderEvent");};d._initLauncherDOM=function(){var i=this.get("element");c.addClass(i,e.CLASS);c.addClass(i,"yui-pv-minimized");this._headEl=document.createElement("div");c.addClass(this._headEl,"hd");var h=e.STRINGS.buttons;var g=(this.get("visible"))?h.hideprofiler:h.viewprofiler;this._toggleVisibleEl=this._createButton(g,this._headEl);this._refreshEl=this._createButton(h.refreshdata,this._headEl);c.addClass(this._refreshEl,e.CLASS_REFRESH);this._busyEl=document.createElement("span");this._headEl.appendChild(this._busyEl);var j=document.createElement("h4");j.innerHTML=e.STRINGS.title;this._headEl.appendChild(j);i.appendChild(this._headEl);a.on(this._toggleVisibleEl,"click",this._toggleVisible,this,true);a.on(this._refreshEl,"click",function(){if(!this._busy){this._setBusyState(true);this.fireEvent("dataRefreshEvent");}},this,true);};d._initViewerDOM=function(){var g=this.get("element");this._bodyEl=document.createElement("div");c.addClass(this._bodyEl,"bd");this._tableEl=document.createElement("div");c.addClass(this._tableEl,e.CLASS_TABLE);this._bodyEl.appendChild(this._tableEl);g.appendChild(this._bodyEl);};d._initChartDOM=function(){this._chartContainer=document.createElement("div");c.addClass(this._chartContainer,e.CLASS_CHART_CONTAINER);var h=document.createElement("div");c.addClass(h,e.CLASS_CHART_LEGEND);var g=document.createElement("div");this._chartLegendEl=document.createElement("dl");this._chartLegendEl.innerHTML="<dd>"+e.STRINGS.initMessage+"</dd>";this._chartEl=document.createElement("div");c.addClass(this._chartEl,e.CLASS_CHART);var i=document.createElement("p");i.innerHTML=e.STRINGS.installFlashMessage;this._chartEl.appendChild(i);this._chartContainer.appendChild(h);h.appendChild(g);g.appendChild(this._chartLegendEl);this._chartContainer.appendChild(this._chartEl);this._bodyEl.insertBefore(this._chartContainer,this._tableEl);};d._createButton=function(i,j,h){var g=document.createElement("a");g.innerHTML=g.title=i;if(j){if(!h){j.appendChild(g);}else{j.insertBefore(g,j.firstChild);}}return g;};d._setBusyState=function(g){if(g){c.addClass(this._busyEl,e.CLASS_BUSY);
this._busy=true;}else{c.removeClass(this._busyEl,e.CLASS_BUSY);this._busy=false;}};d._genSortFunction=function(h,g){var j=h;var i=g;return function(l,k){if(i==YAHOO.widget.DataTable.CLASS_ASC){return l[j]-k[j];}else{return((l[j]-k[j])*-1);}};};var f=function(g){var j=0;for(var h=0;h<g.length;j+=g[h++]){}return j;};d._getProfilerData=function(){var n=b.getFullReport();var q=[];var h=0;for(name in n){if(YAHOO.lang.hasOwnProperty(n,name)){var g=n[name];var k={};k.fn=name;k.points=g.points.slice();k.calls=g.calls;k.min=g.min;k.max=g.max;k.avg=g.avg;k.total=f(k.points);k.points=g.points;var t=this.get("filter");if((!t)||(t(k))){q.push(k);h+=k.total;}}}for(var p=0,m=q.length;p<m;p++){q[p].pct=(h)?(q[p].total*100)/h:0;}var s=this.get("sortedBy");var u=s.key;var l=s.dir;q.sort(this._genSortFunction(u,l));return q;};d._initDataTable=function(){var p=this;this._dataSource=new YAHOO.util.DataSource(function(){return p._getProfilerData.call(p);},{responseType:YAHOO.util.DataSource.TYPE_JSARRAY,maxCacheEntries:0});var h=this._dataSource;h.responseSchema={fields:["fn","avg","calls","max","min","total","pct","points"]};var o=function(s,r,t,u){var q=(u===Math.floor(u))?u:(Math.round(u*1000))/1000;s.innerHTML=q+" "+e.STRINGS.millisecondsAbbrev;};var n=function(s,r,t,u){var q=(u===Math.floor(u))?u:(Math.round(u*100))/100;s.innerHTML=q+"%";};var m=YAHOO.widget.DataTable.CLASS_ASC;var j=YAHOO.widget.DataTable.CLASS_DESC;var k=e.STRINGS.colHeads;var i=o;var l=[{key:"fn",sortable:true,label:k.fn[0],sortOptions:{defaultDir:m},resizeable:(YAHOO.util.DragDrop)?true:false,minWidth:k.fn[1]},{key:"calls",sortable:true,label:k.calls[0],sortOptions:{defaultDir:j},width:k.calls[1]},{key:"avg",sortable:true,label:k.avg[0],sortOptions:{defaultDir:j},formatter:i,width:k.avg[1]},{key:"min",sortable:true,label:k.min[0],sortOptions:{defaultDir:m},formatter:i,width:k.min[1]},{key:"max",sortable:true,label:k.max[0],sortOptions:{defaultDir:j},formatter:i,width:k.max[1]},{key:"total",sortable:true,label:k.total[0],sortOptions:{defaultDir:j},formatter:i,width:k.total[1]},{key:"pct",sortable:true,label:k.pct[0],sortOptions:{defaultDir:j},formatter:n,width:k.pct[1]}];this._dataTable=new YAHOO.widget.DataTable(this._tableEl,l,h,{scrollable:true,height:this.get("tableHeight"),initialRequest:null,sortedBy:{key:"total",dir:YAHOO.widget.DataTable.CLASS_DESC}});var g=this._dataTable;g.subscribe("sortedByChange",this._sortedByChange,this,true);g.subscribe("renderEvent",this._dataTableRenderHandler,this,true);g.subscribe("initEvent",this._dataTableRenderHandler,this,true);a.on(this._tableEl.getElementsByTagName("th"),"click",this._thClickHandler,this,true);};d._sortedByChange=function(g){if(g.newValue&&g.newValue.key){this.set("sortedBy",{key:g.newValue.key,dir:g.newValue.dir});}};d._dataTableRenderHandler=function(g){this._setBusyState(false);};d._thClickHandler=function(g){this._setBusyState(true);};d._refreshDataTable=function(g){var h=this._dataTable;h.getDataSource().sendRequest("",h.onDataReturnInitializeTable,h);};d._refreshChart=function(){switch(this.get("sortedBy").key){case"fn":this._chart.set("dataSource",this._chart.get("dataSource"));return;case"calls":this._chart.set("xAxis",this._chartAxisDefinitionPlain);break;case"pct":this._chart.set("xAxis",this._chartAxisDefinitionPercent);break;default:this._chart.set("xAxis",this._chartAxisDefinitionTime);break;}this._drawChartLegend();this._chart.set("series",this._getSeriesDef(this.get("sortedBy").key));};d._getChartData=function(){var h=this._dataTable.getRecordSet().getRecords(0,this.get("maxChartFunctions"));var g=[];for(var l=0,k=h.length;l<k;l++){g.push(h[l].getData());}return g;};d._getSeriesDef=function(m){var l=this.get("chartSeriesDefinitions")[m];var g=[];for(var k=0,h=l.group.length;k<h;k++){var n=this.get("chartSeriesDefinitions")[l.group[k]];g.push({displayName:n.displayName,xField:n.xField,style:{color:n.style.color,size:n.style.size}});}return g;};d._initChart=function(){this._sizeChartCanvas();YAHOO.widget.Chart.SWFURL=this.get("swfUrl");var g=this;var h=new YAHOO.util.DataSource(function(){return g._getChartData.call(g);},{responseType:YAHOO.util.DataSource.TYPE_JSARRAY,maxCacheEntries:0});h.responseSchema={fields:["fn","avg","calls","max","min","total","pct"]};h.subscribe("responseEvent",this._sizeChartCanvas,this,true);this._chartAxisDefinitionTime=new YAHOO.widget.NumericAxis();this._chartAxisDefinitionTime.labelFunction="YAHOO.widget.ProfilerViewer.timeAxisLabelFunction";this._chartAxisDefinitionPercent=new YAHOO.widget.NumericAxis();this._chartAxisDefinitionPercent.labelFunction="YAHOO.widget.ProfilerViewer.percentAxisLabelFunction";this._chartAxisDefinitionPlain=new YAHOO.widget.NumericAxis();this._chart=new YAHOO.widget.BarChart(this._chartEl,h,{yField:"fn",series:this._getSeriesDef(this.get("sortedBy").key),style:this.get("chartStyle"),xAxis:this._chartAxisDefinitionTime});this._drawChartLegend();this._chartInitialized=true;this._dataTable.unsubscribe("initEvent",this._initChart,this);this._dataTable.subscribe("initEvent",this._refreshChart,this,true);};d._drawChartLegend=function(){var p=this.get("chartSeriesDefinitions");var k=p[this.get("sortedBy").key];var h=this._chartLegendEl;h.innerHTML="";for(var n=0,m=k.group.length;n<m;n++){var q=p[k.group[n]];var o=document.createElement("dt");c.setStyle(o,"backgroundColor","#"+q.style.color);var g=document.createElement("dd");g.innerHTML=q.displayName;h.appendChild(o);h.appendChild(g);}};d._sizeChartCanvas=function(i){var g=(i)?i.response.length:this.get("maxChartFunctions");var h=(g*36)+34;if(h!=parseInt(this._chartElHeight,10)){this._chartElHeight=h;c.setStyle(this._chartEl,"height",h+"px");}};d.initAttributes=function(g){YAHOO.widget.ProfilerViewer.superclass.initAttributes.call(this,g);this.setAttributeConfig("base",{value:g.base});this.setAttributeConfig("tableHeight",{value:g.tableHeight||"15em",method:function(h){if(this._dataTable){this._dataTable.set("height",h);}}});this.setAttributeConfig("sortedBy",{value:g.sortedBy||{key:"total",dir:"yui-dt-desc"}});
this.setAttributeConfig("filter",{value:g.filter||null,validator:YAHOO.lang.isFunction});this.setAttributeConfig("swfUrl",{value:g.swfUrl||"http://yui.yahooapis.com/2.5.0/build/charts/assets/charts.swf"});this.setAttributeConfig("maxChartFunctions",{value:g.maxChartFunctions||6,method:function(h){if(this._rendered){this._sizeChartCanvas();}},validator:YAHOO.lang.isNumber});this.setAttributeConfig("chartStyle",{value:g.chartStyle||{font:{name:"Arial",color:15658588,size:12},background:{color:"6e6e63"}},method:function(){if(this._rendered&&this.get("showChart")){this._refreshChart();}}});this.setAttributeConfig("chartSeriesDefinitions",{value:g.chartSeriesDefinitions||{total:{displayName:e.STRINGS.colHeads.total[0],xField:"total",style:{color:"4d95dd",size:20},group:["total"]},calls:{displayName:e.STRINGS.colHeads.calls[0],xField:"calls",style:{color:"edff9f",size:20},group:["calls"]},avg:{displayName:e.STRINGS.colHeads.avg[0],xField:"avg",style:{color:"209daf",size:9},group:["avg","min","max"]},min:{displayName:e.STRINGS.colHeads.min[0],xField:"min",style:{color:"b6ecf4",size:9},group:["avg","min","max"]},max:{displayName:e.STRINGS.colHeads.max[0],xField:"max",style:{color:"29c7de",size:9},group:["avg","min","max"]},pct:{displayName:e.STRINGS.colHeads.pct[0],xField:"pct",style:{color:"C96EDB",size:20},group:["pct"]}},method:function(){if(this._rendered&&this.get("showChart")){this._refreshChart();}}});this.setAttributeConfig("visible",{value:g.visible||false,validator:YAHOO.lang.isBoolean,method:function(h){if(h){this._show();}else{if(this._rendered){this._hide();}}}});this.setAttributeConfig("showChart",{value:g.showChart||true,validator:YAHOO.lang.isBoolean,writeOnce:true});YAHOO.widget.ProfilerViewer.superclass.initAttributes.call(this,g);};})();YAHOO.register("profilerviewer",YAHOO.widget.ProfilerViewer,{version:"@VERSION@",build:"@BUILD@"});